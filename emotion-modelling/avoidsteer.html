<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Alcoholic</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emosteer.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');

    var persongrid = new PersonGrid(view.size.width,view.size.height);
		var personarray;
    var RAD = 15;
		var WIDTH = view.size.width;
		var HEIGHT = view.size.height;

		var hero = new Person(true,new Point(0.1 * WIDTH,0.4 * HEIGHT),2,-8,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'red'
		}), new Point());

		var obstacle1 = new Person(true,new Point(WIDTH - 40 * RAD,0.32 * HEIGHT),7,6,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'black'
		}), new Point());

		var obstacle2 = new Person(true,new Point(WIDTH - 50 * RAD,0.3 * HEIGHT),7,6,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'black'
		}), new Point());

    var target = new Person(true,new Point(WIDTH - 1.0 * RAD,0.235 * HEIGHT),0.1,2,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'blue'
		}), new Point());

		persongrid.set(hero.phys.position,hero);
	  persongrid.set(obstacle1.phys.position,obstacle1);
		persongrid.set(obstacle2.phys.position,obstacle2);
		persongrid.set(target.phys.position,target);

		var vars = {
			offset : 0,
			framecount : 0
		}

		function scene1(event) {
      console.log("In scene 1");
			if (vars.framecount === 0) {
				hero.clearPath();
			}
			vars.framecount++;
      hero.followVec(target.phys.position.subtract(hero.phys.position), false, personarray, event.delta);
      if (vars.offset != -1) {
				vars.offset = hero.moveAlongPath(vars.offset,event.delta);
			}
		}
		var currentScene = scene1;
		view.onFrame = function(event) {
			personarray = persongrid.localSearch(hero.phys.position.x-4*RAD, hero.phys.position.x+10*RAD, hero.phys.position.y-10*RAD, hero.phys.position.y+10*RAD, hero);
			var heroprev = hero.phys.position;
      var obstacle1prev = obstacle1.phys.position;
      var obstacle2prev = obstacle2.phys.position;
			var targetprev = target.phys.position;

			currentScene(event);

			persongrid.update(heroprev,hero.phys.position,hero);
			persongrid.update(obstacle1prev,obstacle1.phys.position,obstacle1);
			persongrid.update(obstacle2prev,obstacle2.phys.position,obstacle2);
			persongrid.update(targetprev,target.phys.position,target);
			//var person_array = persongrid.localSearch(0,960,0,960,hero);


			var selrect = new Path.Rectangle(new Point(hero.phys.position.x-4*RAD, hero.phys.position.y-10*RAD), new Point(hero.phys.position.x+10*RAD, hero.phys.position.y+10*RAD))
			selrect.selected = false;
			//console.log(person_array.length + "is PA");
		}
	}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>
