<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Alcoholic</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emonewGod.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');
		var RAD = 15;
		var num = 2;
		var persons = new Array(num);
		var targets = new Array(num);
		var offsets = new Array(num);
		var prev = new Array(num);
		var personarrays = new Array(num);
		var persongrid = new PersonGrid(view.size.width,view.size.height);

			persons[0] = new Person(true,new Point(view.center.x-150, view.center.y-100),5,0,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'red'
		}));
			targets[0] = new Person(false,new Point(view.center.x + 300, view.center.y-100),0.1,2,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'blue'
		}));
			//targets[i].phys.visible = false;
			persongrid.set(persons[0].phys.position,persons[0]);


		    persons[1] = new Person(true,new Point(view.center.x, view.center.y+50),5,0,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'black'
		})); 
			targets[1] = new Person(false,new Point(view.center.x, view.center.y-200),0.1,2,20,new Path.Circle({
			center : view.center,
			radius : RAD/5,
			fillColor : 'blue'
		}));

			//targets[i].phys.visible = false;
			persongrid.set(persons[1].phys.position,persons[1]);

		for (var i = persons.length - 1; i >= 0; i--) {
			persons[i].clearPath();
			offsets[i] = 0;
		}

		view.onFrame = function(event) {
			for (var i = persons.length - 1; i >= 0; i--) {
				prev[i] = persons[i].phys.position;
			}
			for (var i = persons.length - 1; i >= 0; i--) {
				personarrays[i] = persongrid.localSearch(persons[i].phys.position.x-20*RAD, persons[i].phys.position.x+20*RAD, persons[i].phys.position.y-20*RAD, persons[i].phys.position.y+20*RAD,persons[i]);
			}
			for (var i = persons.length - 1; i >= 0; i--) {
				persons[i].followandAvoidPerson(targets[i],personarrays[i],event.delta);
			}

			for (var i = persons.length - 1; i >= 0; i--) {
        if (offsets[i] != -1) {
  				offsets[i] = persons[i].moveAlongPath(offsets[i],event.delta);
  			}
			}

			for (var i = persons.length - 1; i >= 0; i--) {
				persongrid.update(prev[i],persons[i].phys.position,persons[i]);
			}
		}
	}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>
