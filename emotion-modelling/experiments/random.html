<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Alcoholic</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emonewGod.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');
		var RAD = 15;
		var num = 10;
		var persons = new Array(num);
		var targets = new Array(num);
		var offsets = new Array(num);
		var prev = new Array(num);
		var personarrays = new Array(num);
		var persongrid = new PersonGrid(view.size.width,view.size.height);
		for (var i = persons.length - 1; i >= 0; i--) {
			persons[i] = new Person(false,Point.random().multiply(view.size),3 + 5 * Math.random(),0,5 + 5 * Math.random(),new Path.Circle({
				center : view.center,
				radius : 15,
				fillColor : 'red'
			}));
			targets[i] = new Person(true,Point.random().multiply(view.size),3 + 5 * Math.random(),0,5 + 5 * Math.random(),new Path.Circle({
				center : view.center,
				radius : 5,
				fillColor : 'blue'
			}));
			//targets[i].phys.visible = false;
			persongrid.set(persons[i].phys.position,persons[i]);
		}
		for (var i = persons.length - 1; i >= 0; i--) {
			persons[i].clearPath();
			offsets[i] = 0;
		}
		view.onFrame = function(event) {
			for (var i = persons.length - 1; i >= 0; i--) {
				prev[i] = persons[i].phys.position;
			}
			for (var i = persons.length - 1; i >= 0; i--) {
				personarrays[i] = persongrid.localSearch(persons[i].phys.position.x-20*RAD, persons[i].phys.position.x+20*RAD, persons[i].phys.position.y-20*RAD, persons[i].phys.position.y+20*RAD,persons[i]);
			}
			for (var i = persons.length - 1; i >= 0; i--) {
				persons[i].followandAvoidPerson(targets[i],personarrays[i],event.delta);
			}

			for (var i = persons.length - 1; i >= 0; i--) {
        if (offsets[i] != -1) {
  				offsets[i] = persons[i].moveAlongPath(offsets[i],event.delta);
  			}
			}

			for (var i = persons.length - 1; i >= 0; i--) {
				persongrid.update(prev[i],persons[i].phys.position,persons[i]);
			}
		}
	}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>
