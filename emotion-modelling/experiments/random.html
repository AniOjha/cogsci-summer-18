<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Alcoholic</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emonewGod.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');
		var RAD = 15;
		var persons = new Array(4);
		var targets = new Array(4);
		var prev = new Array(4);
		var personarrays = new Array(4);
		var persongrid = new PersonGrid(view.size.width,view.size.height);
		for (var i = persons.length - 1; i >= 0; i--) {
			persons[i] = new Person(true,Point.random().multiply(view.size),5 + 5 * Math.random(),5 + 5 * Math.random(),5 + 5 * Math.random(),new Path.Circle({
				center : view.center,
				radius : 15,
				fillColor : 'red'
			}));
			targets[i] = new Person(false,Point.random().multiply(view.size),5 + 5 * Math.random(),5 + 5 * Math.random(),5 + 5 * Math.random(),new Path.Circle({
				center : view.center,
				radius : 15,
				fillColor : 'blue'
			}));
			targets[i].phys.visible = false;
			persongrid.set(persons[i].phys.position,persons[i]);
		}
		for (var i = persons.length - 1; i >= 0; i--) {
			persons[i].clearPath();
		}
		view.onFrame = function(event) {
			for (var i = persons.length - 1; i >= 0; i--) {
				prev[i] = persons[i].phys.position;
			}
			for (var i = persons.length - 1; i >= 0; i--) {
				personarrays[i] = persongrid.localSearch(persons[i].phys.position.x-4*RAD, persons[i].phys.position.x+10*RAD, persons[i].phys.position.y-10*RAD, persons[i].phys.position.y+10*RAD,persons[i]);
			}
			for (var i = persons.length - 1; i >= 0; i--) {
				persons[i].followandAvoidPerson(targets[i],personarrays[i],event.delta);
			}
			/*
				INSERT LOGIC OF MOTION HERE
			*/
			for (var i = persons.length - 1; i >= 0; i--) {
				persongrid.update(prev[i],persons[i].phys.position,persons[i]);
			}
		}
	}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>
