<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Alcoholic</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emotion_threeparam.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');
		console.log("WHAT");
		var RAD = 15;
		var WIDTH = view.size.width;
		var HEIGHT = view.size.height;

    var male = new Person(false,new Point(0.36 * WIDTH,0.3 * HEIGHT),2.5,3,15,new Path.Circle({  //initially seductive
      center : view.center,
      radius : RAD,
      fillColor : 'red'
    }));

    var female = new Person(false,new Point(0.24 * WIDTH,0.3 * HEIGHT),2.5,3,12,new Path.Circle({  //initially seductive
      center : view.center,
      radius : RAD,
      fillColor : 'pink'
    }));

    var secondmale = new Person(false,new Point(WIDTH * 0.45,0.6 * HEIGHT),20,5,20,new Path.Circle({  //initially determined
      center : view.center,
      radius : RAD,
      fillColor : 'blue'
    }));

		var scene1vars = {
      offset1 : 0,
      offset2 : 0,
      offset3 : 0,
			framecount : 0
		}
    var scene2vars = {
      offset1 : 0,
      offset2 : 0,
      offset3 : 0,
			framecount : 0
		}
    var scene3vars = {
      offset1 : 0,
      offset2 : 0,
      offset3 : 0,
			framecount : 0
		}
    var scene4vars = {
      offset1 : 0,
      offset2 : 0,
      offset3 : 0,
			framecount : 0
		}
		var scene5vars = {
      offset1 : 0,
      offset2 : 0,
      offset3 : 0,
			framecount : 0,
      hit : 3,
      count : 0
		}

		function scene5(event) {
			console.log("In scene 5");
      if (scene5vars.framecount === 0) {
			  male.clearPath();
			  secondmale.clearPath();
			}
      console.log("Hit is " + scene5vars.hit);
			scene5vars.framecount++;
			var dist = (male.phys.position.subtract(secondmale.phys.position)).length;
console.log("Dist is " + dist);
			if(dist>2.1* RAD){
				male.followPerson(secondmale);
				secondmale.followPerson(male);
				if (scene5vars.offset1 != -1) {
					scene5vars.offset1 = male.moveAlongPath(scene5vars.offset1,event.delta);
				} else {
					scene5vars.offset1 = 0;
					male.clearPath();
				}
				if (scene5vars.offset3 != -1) {
					scene5vars.offset3 = secondmale.moveAlongPath(scene5vars.offset3,event.delta);
				} else {
					scene5vars.offset3 = 0;
					secondmale.clearPath();
				}
			}
			if(scene5vars.count < 8){
				if(scene5vars.hit==3){
          console.log("First will hit");
					male.followPerson(secondmale);
					if (scene5vars.offset1 != -1) {
						scene5vars.offset1 = male.moveAlongPath(scene5vars.offset1,event.delta);
					}
					if (dist < 2.1 * RAD){
            male.clearPath();
            scene5vars.offset1 = 0;
            console.log("Here");
						secondmale.retreatFromPerson(male, 4 * RAD);
						if (scene5vars.offset3 != -1) {
							scene5vars.offset3 = secondmale.moveAlongPath(scene5vars.offset3,event.delta);
						} else{
              scene5vars.count++;
  						scene5vars.hit = 1;
  						scene5vars.offset3 = 0;
           }

					}
				} else if(scene5vars.hit==1){
          console.log("Second will hit");
					secondmale.followPerson(male);
					if (scene5vars.offset3 != -1) {
						scene5vars.offset3 = secondmale.moveAlongPath(scene5vars.offset3,event.delta);
					}
					if (dist < 2.05 * RAD){
						secondmale.clearPath();
            scene5vars.offset3 = 0;
						male.retreatFromPerson(secondmale, 4 * RAD);
						if (scene5vars.offset1 != -1) {
							scene5vars.offset1 = male.moveAlongPath(scene5vars.offset1,event.delta);
						} else {
              scene5vars.count++;
  						scene5vars.hit = 3;
  						scene5vars.offset1 = 0;
            }
					}
				}
      } else {
        currentScene = scene6;
      }
		}

		function scene4(event) {
			console.log("In scene 4");
      var dif = (male.phys.position.subtract(secondmale.phys.position)).length;
      if (scene4vars.framecount === 0) {
				secondmale.clearPath();
        female.clearPath();
			}
      console.log(dif);
      //console.log(scene2vars.offset1);
      secondmale.retreatFromPerson(male, 10 * RAD);
      //var endpt = new Point(0.15 * WIDTH,0.5 * HEIGHT);
      female.retreatFromPerson(secondmale, 10 * RAD);

      if (scene4vars.offset3 != -1) {
      	scene4vars.offset3 = secondmale.moveAlongPath(scene4vars.offset3,event.delta);
      } else {
        console.log("Switching to Scene 5");
				male.arousal = 3;
				male.eagerness = 8;
				male.focus = 16;
        //he is now in fight-mode

        secondmale.arousal = 3;
				secondmale.eagerness = 8;
				secondmale.focus = 16;
        //he is now in fight-mode

        female.arousal = 0;
				female.eagerness = 0;
				female.focus = 0;
        //she is now still

				currentScene = scene5;
      }

      if (scene4vars.offset2 != -1) {
      	scene4vars.offset2 = female.moveAlongPath(scene4vars.offset2,event.delta);
      }
		}

		function scene3(event) {
      console.log("In scene 3");
      if (scene3vars.framecount === 0) {
        male.clearPath();
        female.clearPath();
        secondmale.clearPath();
      }
      scene3vars.framecount++;
      male.followPerson(secondmale);
      female.followPerson(secondmale);
      secondmale.followPerson(female);

      if (scene3vars.offset1 != -1) {
        scene3vars.offset1 = male.moveAlongPath(scene3vars.offset1,event.delta);
      }
      if (scene3vars.offset2 != -1) {
        scene3vars.offset2 = female.moveAlongPath(scene3vars.offset2,event.delta);
      }
      if (scene3vars.offset3 != -1) {
        scene3vars.offset3 = secondmale.moveAlongPath(scene3vars.offset3,event.delta);
      }
      var dif = (male.phys.position.subtract(secondmale.phys.position)).length;
      console.log("Dif is " + (male.phys.position.subtract(secondmale.phys.position)).length);
      console.log(2.05 * RAD);
      if (dif < 2.05 * RAD) {
        console.log("Switching to Scene 4");
        male.arousal = 0;
        male.eagerness = 0;
        male.focus = 0;
        //he is now still

        secondmale.arousal = 1;
        secondmale.eagerness = 7;
        secondmale.focus = 25;
        //he is now being flung away

        female.arousal = 1;
        female.eagerness = 7;
        female.focus = 20;
        //she is now scared

        currentScene = scene4;
      }
		}

		function scene2(event) {
      console.log("In scene 2");
      var dif = (male.phys.position.subtract(secondmale.phys.position)).length;
      if (scene2vars.framecount === 0) {
				male.clearPath();
        female.clearPath();
			}
      console.log(dif);
      console.log(scene2vars.offset1);
      male.retreatFromPerson(secondmale, 10 * RAD);
      female.retreatFromPerson(secondmale, 6 * RAD);

      if (scene2vars.offset1 != -1) {
      	scene2vars.offset1 = male.moveAlongPath(scene2vars.offset1,event.delta);
      } else {
        console.log("Switching to Scene 3");
				male.arousal = 2;
				male.eagerness = 8.5;
				male.focus = 16;
        //he is now very angrily approaching

        secondmale.arousal = 0.5;
				secondmale.eagerness = 3;
				secondmale.focus = 15;
        //he is now seductive

        female.arousal = 0.5;
				female.eagerness = 3;
				female.focus = 15;
        //she is now seductive

				currentScene = scene3;
      }

      if (scene2vars.offset2 != -1) {
      	scene2vars.offset2 = female.moveAlongPath(scene2vars.offset2,event.delta);
      }
		}

		function scene1(event) {
      console.log("In scene 1");
      if (scene1vars.framecount === 0) {
				male.clearPath();
        female.clearPath();
        secondmale.clearPath();
			}
			scene1vars.framecount++;
			male.followPerson(female);
      female.followPerson(male);
      secondmale.followPerson(male);

			if (scene1vars.offset1 != -1) {
				scene1vars.offset1 = male.moveAlongPath(scene1vars.offset1,event.delta);
			}
      if (scene1vars.offset2 != -1) {
				scene1vars.offset2 = female.moveAlongPath(scene1vars.offset2,event.delta);
			}
      if (scene1vars.offset3 != -1) {
				scene1vars.offset3 = secondmale.moveAlongPath(scene1vars.offset3,event.delta);
			}
			var dif = (male.phys.position.subtract(secondmale.phys.position)).length;
			console.log("Dif is " + (male.phys.position.subtract(secondmale.phys.position)).length);
      //console.log(2.05 * RAD);
			if (dif < 2.01 * RAD) {
				console.log("Switching to Scene 2");
				male.arousal = 1;
				male.eagerness = 5;
				male.focus = 25;
        //he is now being flung away
        secondmale.arousal = 0;
        secondmale.eagerness = 0;
        secondmale.focus = 0;
        //he is now still

        female.arousal = 5;
        female.eagerness = 3;
        female.focus = 2;
        //she is now scared

        currentScene = scene2;
      }

		}
		var currentScene = scene1;
		view.onFrame = function(event) {
			currentScene(event);
		}
	}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>
