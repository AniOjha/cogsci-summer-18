<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Cop and Robber</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emotion_threeparam.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');

		var RAD = 15;
		var WIDTH = view.size.width;
		var HEIGHT = view.size.height;

		var robber = new Person(false,Point.random().multiply(view.size),0,-8,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'red'
		}));

		var cop = new Person(false,view.center,0,0,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'blue'
		}));
		gold = new Path.Circle({
			center : view.center,
			radius : 3,
			fillColor : 'yellow'
		});
		gold.position = cop.phys.position.add(new Point(0,-80));
		var scene1vars = {
			offsetr : 0,
			offsetc : 0,
			framecount : 0
		};

		var scene2vars = {
			offsetr : 0,
			offsetc : 0,
			framecount : 0,
			approach: false,
			disappear: false,
			count : 0
		};

		var scene3vars = {
			offsetr : 0,
			offsetc : 0,
			framecount : 0
		};

		function scene2(event) {
			if (scene2vars.framecount ===0){
				robber.clearPath();
				cop.clearPath();
			}
			if(scene2vars.disappear===false){
			cop.followPerson(robber);
			if(scene2vars.approach===false){
			robber.retreatFromPerson(cop,99*RAD);
			}
			else{
				robber.followPerson(cop);
				console.log("follow")
			}
		    }
			//console.log("Offset " + scene2vars.offset + " Pathlength " + alcoholic.movement.path.length);
			scene2vars.framecount++
			if (scene2vars.offsetc != -1) {
				scene2vars.offsetc = cop.moveAlongPath(scene2vars.offsetc,event.delta);
				console.log(scene2vars.offsetc)
			}
			
			if (scene2vars.offsetr != -1) {
				scene2vars.offsetr = robber.moveAlongPath(scene2vars.offsetr,event.delta);
			}

			var dist = (robber.phys.position.subtract(cop.phys.position)).length;
			if(dist < 40*RAD){
				scene2vars.approach = false;
			}
		    if((robber.phys.position.x<-3*RAD|| robber.phys.position.x > WIDTH+3*RAD)&&scene2vars.approach===false){
		    	if(scene2vars.disappear===false){
		    		scene2vars.count=0;
		    		scene2vars.disappear=true;
		    	}
		    	scene2vars.count++
		    	if(scene2vars.count===1){
		    	robber.clearPath();
		    	}
		    	if(scene2vars.count===80){
		    	cop.clearPath();
		   		}
		    	if(scene2vars.count>=80){
		    	cop.stand();
		        }
		    	if(scene2vars.count===200){
			    	var y = cop.phys.position.y
			    	if (y>HEIGHT/2){
			    		robber.phys.position.y = RAD;
			    	}
			    	else{
			    		robber.phys.position.y = HEIGHT-RAD;
			    	}
			    	robber.phys.position.x=WIDTH*Math.random();
			    	robber.clearPath();
			    	robber.followPerson(cop);
			    	scene2vars.disappear=false;
			    	scene2vars.approach=true;
			    	scene2vars.offsetr = 0;
			    	scene2vars.offsetc = 0;
			    }
			   	}

			   	if((robber.phys.position.y<-3*RAD|| robber.phys.position.y > HEIGHT+3*RAD)&&scene2vars.approach===false){
		    	if(scene2vars.disappear===false){
		    		scene2vars.count=0;
		    		scene2vars.disappear=true;
		    	}
		    	scene2vars.count++
		    	if(scene2vars.count===1){
		    	robber.clearPath();
		    	}
		    	if(scene2vars.count===80){
		    	cop.clearPath();
		   		}
		    	if(scene2vars.count>=80){
		    	cop.stand();
		        }
		    	if(scene2vars.count===200){
			    	var x = cop.phys.position.x
			    	if (x>WIDTH/2){
			    		robber.phys.position.x = RAD;
			    	}
			    	else{
			    		robber.phys.position.x = WIDTH-RAD;
			    	}
			    	robber.phys.position.y=HEIGHT*Math.random(); 
			    	robber.clearPath();
			    	robber.followPerson(cop);
			    	scene2vars.disappear=false;
			    	scene2vars.approach=true;
			    	scene2vars.offsetr = 0;
			    	scene2vars.offsetc = 0;
			    }
			   	}

			}

		function scene1(event) {
			if (scene1vars.framecount === 0) {
				robber.clearPath();
				cop.clearPath();
				cop.moveToPoint(view.center.add(200,0));
		    	robber.moveToPoint(gold.position);
			}
			scene1vars.framecount++
			if (scene1vars.offsetc != -1) {
				scene1vars.offsetc = cop.moveAlongPath(scene1vars.offsetc,event.delta);
			}
			if (scene1vars.offsetr != -1) {
				scene1vars.offsetr = robber.moveAlongPath(scene1vars.offsetr,event.delta);
				//console.log(scene1vars.offsetr);
			}
			var dist = (robber.phys.position.subtract(gold.position)).length;
			//console.log("Diff " + (alcoholic.phys.position.subtract(bartender.position)).x);
			if (dist < RAD) {
				console.log("Switching to Scene 2");
				gold.fillColor = 'white'
				cop.arousal = 4;
				cop.eagerness = 8;
				cop.focus = 16;
				robber.focus = 12;
				robber.eagerness = 12;
				robber.arousal = 1;
				//alcoholic.debug = true;
				robber.clearPath();
				cop.clearPath();
				currentScene = scene2;

		}
	}
		var currentScene = scene1;
		view.onFrame = function(event) {
			currentScene(event);
		}
	}	

	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>