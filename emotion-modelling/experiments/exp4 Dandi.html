<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Cop and Robber</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emotion_threeparam.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');

		var RAD = 15;
		var WIDTH = view.size.width;
		var HEIGHT = view.size.height;

		var robber = new Person(true,Point.random().multiply(view.size),0,-8,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'red'
		}));

		var cop = new Person(true,view.center,0,0,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'blue'
		}));
		gold = new Path.Circle({
			center : view.center,
			radius : 3,
			fillColor : 'yellow'
		});
		gold.position = cop.phys.position.add(new Point(0,-80));
		var scene1vars = {
			offsetr : 0,
			offsetc : 0,
			framecount : 0
		};

		var scene2vars = {
			offsetr : 0,
			offsetc : 0,
			framecount : 0,
			approach: false,
			disappear: false,
			count : 0
		};

		var scene3vars = {
			offsetr : 0,
			offsetc : 0,
			framecount : 0
		};

		function scene2(event) {
			if (scene2vars.framecount ===0){
				robber.clearPath();
				cop.clearPath();
			}
			if(scene2vars.disappear===false){
			cop.followPerson(robber);
			if(scene2vars.approach===false){
			robber.retreatFromPerson(cop,99*RAD);
			}
			else{
				robber.followPerson(cop);
			}
			}//console.log("Offset " + scene2vars.offset + " Pathlength " + alcoholic.movement.path.length);
			scene2vars.framecount++
			if (scene2vars.offsetc != -1) {
				scene2vars.offsetc = cop.moveAlongPath(scene2vars.offsetc,event.delta);
				console.log(scene2vars.offsetc)
			}
			if (robber.movement.path.length>0){
			if (scene2vars.offsetr != -1) {
				scene2vars.offsetr = robber.moveAlongPath(scene2vars.offsetr,event.delta);
			}
		}
		    if(robber.phys.position.x<-2*RAD|| robber.phys.position.x > WIDTH+2*RAD){
		    	scene2vars.count++
		    	if(scene2vars.count===1){
		    	robber.clearPath();
		    	cop.clearPath();
		    	scene2vars.disappear=true
		    	}
		    	cop.stand();
		    	if(scene2vars.count===300){
			    	var num = 2*Math.random()-1;
			    	if (num>0){
			    		robber.phys.position.y = HEIGHT+RAD;
			    		robber.phys.position.x = WIDTH*Math.random();
			    	}
			    	else{
			    		robber.phys.position.y = -RAD;
			    		robber.phys.position.x = WIDTH*Math.random();
			    	}
			    	robber.followPerson(cop)
			    	scene2vars.disappear===false;
			    	scene2vars.approach===true;
			    }
		    }
		    if(robber.phys.position.y<-2*RAD|| robber.phys.position.y > HEIGHT+2*RAD){
		    	scene2vars.count++
		    	if(scene2vars.count===1){
		    	robber.clearPath();
		    	cop.clearPath();
		    	scene2vars.disappear=true
		    	}
		    	cop.stand();
		    	if(scene2vars.count===300){
			    	var num = 2*Math.random()-1;
			    	if (num>0){
			    		robber.phys.position.y = HEIGHT+RAD;
			    		robber.phys.position.x = WIDTH*Math.random();
			    	}
			    	else{
			    		robber.phys.position.y = -RAD;
			    		robber.phys.position.x = WIDTH*Math.random();
			    	}
			    	robber.followPerson(cop)
			    	scene2vars.disappear===false;
			    	scene2vars.approach===true;
			    }
		    }
		}

		function scene1(event) {
			if (scene1vars.framecount === 0) {
				robber.clearPath();
				cop.clearPath();
				cop.moveToPoint(view.center.add(200,0));
		    	robber.moveToPoint(gold.position);
			}
			scene1vars.framecount++
			if (scene1vars.offsetc != -1) {
				scene1vars.offsetc = cop.moveAlongPath(scene1vars.offsetc,event.delta);
			}
			if (scene1vars.offsetr != -1) {
				scene1vars.offsetr = robber.moveAlongPath(scene1vars.offsetr,event.delta);
				//console.log(scene1vars.offsetr);
			}
			var dist = (robber.phys.position.subtract(gold.position)).length;
			//console.log("Diff " + (alcoholic.phys.position.subtract(bartender.position)).x);
			if (dist < RAD) {
				console.log("Switching to Scene 2");
				gold.fillColor = 'white'
				cop.arousal = 4;
				cop.eagerness = 5;
				cop.focus = 16;
				robber.focus = 12;
				robber.eagerness = 10;
				robber.arousal = 1;
				//alcoholic.debug = true;
				robber.clearPath();
				cop.clearPath();
				currentScene = scene2;

		}
	}
		var currentScene = scene1;
		view.onFrame = function(event) {
			currentScene(event);
		}
	}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>