<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Consulting</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emotion_threeparam.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');

		var RAD = 15;
		var WIDTH = view.size.width;
		var HEIGHT = view.size.height;

		var person1 = new Person(false,new Point(WIDTH - 1.0 * RAD,0.25 * HEIGHT),0.1,2,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'blue'
		}));

		var person2 = new Person(false,new Point(0.1 * WIDTH,0.4 * HEIGHT),2,-8,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'red'
		}));

		var person3 = new Person(false,new Point(WIDTH - 7.5 * RAD,0.1 * HEIGHT),7,6,20,new Path.Circle({
			center : view.center,
			radius : 1.3 * RAD,
			fillColor : 'black'
		}));


var vars = {
	offset1 : 0,
	offset2 : 0,
	offset3 : 0,
	framecount : 0,
	count : 0,
	approachmode : true
}

		function person1_chase_person2(event) {
			console.log("P1 chase P2");
			if(vars.framecount==0){
				person1.clearPath();
				person2.clearPath();
			}
			vars.framecount++;
//main (simultaneous) movement calls
			person1.followPerson(person2);
			person2.retreatFromPerson(person1, 5 * RAD);

			if (vars.offset2 != -1) {
				vars.offset2 = person2.moveAlongPath(vars.offset2,event.delta);
			}
			if (vars.offset1 != -1) {
				vars.offset1 = person1.moveAlongPath(vars.offset1,event.delta);
			}
			if ((vars.offset2 == -1 && vars.offset1 == -1) || person2.phys.position.x < -1000) {
				console.log("End");
			}
		}

function person1_follow_person2(event) {

  var dist = person1.phys.position.subtract(person2.phys.position);
  if(dist.length > 3 * RAD){
    if(vars.count++ == 0) {
      person1.clearPath();
    }

//main movement call
    person1.followPerson(person2);
  }
    if (vars.offset1 != -1 && dist.length > 3 * RAD) {
      console.log("Hit person2");
      vars.offset1 = person1.moveAlongPath(vars.offset1,event.delta);
    } else {
    person2.eagerness = 8;
    person2.arousal = 0;
    person2.focus = 10;		//bhaago

    person1.eagerness = 6;
    person1.arousal = 7;
    person1.focus = 7;		//a n g e r y

    vars.offset1 = 0;
    vars.count = 0;
    nextmove = person1_chase_person2;
  }
}

		function person1_move_(event) {
			console.log("person1_move_");
			var dist = person1.phys.position.subtract(person2.phys.position);
			if(vars.framecount==0){
				person1.clearPath();
				person2.clearPath();

//main movement call
				person1.moveToPoint(new Point(view.center.x,person2.phys.position.y));
			}
			vars.framecount++;
			if (vars.offset1 != -1) {
				vars.offset1 = person1.moveAlongPath(vars.offset1,event.delta);
			} else {
        vars.framecount = 0;
				vars.offset1 = 0;
				nextmove = person1_follow_person2;
			}
		}

function person3_goto_person1(event){

  console.log("person3_goto_person1");
  var dist = person1.phys.position.subtract(person3.phys.position);
  if(dist.length > 2.45 * RAD){

//main movement call
    person3.followPerson(person1);
    if (vars.offset3 != -1) {
      vars.offset3 = person3.moveAlongPath(vars.offset3,event.delta);
    }
  } else {
    person2.eagerness = 4;
    person2.arousal = 0;
    person2.focus = 10;		//bhaago

    person1.eagerness = 4;
    person1.arousal = 1;
    person1.focus = 7;		//a n g e r y

    vars.offset3 = 0;
    nextmove = person1_move_;
  }
}

		function person1_goto_person3(event) {
			console.log("person1_goto_person3");
			if(vars.framecount==0){
				person1.clearPath();
				person3.clearPath();
			}
			vars.framecount++;

// main movement call
			person1.followPerson(person3);

			var dist = person1.phys.position.subtract(person3.phys.position);
			if (vars.offset1 != -1 && dist.length > 5 * RAD) {
				vars.offset1 = person1.moveAlongPath(vars.offset1,event.delta);
			} else {
        vars.framecount = 0;
        vars.offset1 = 0;
        nextmove = person3_goto_person1;
      }
		}

		 function person2_goto_person1(event) {
		 	console.log("P2 goto P1");
			if(vars.framecount==0){
				person2.clearPath();
			}
			vars.framecount++;

//main movement call
			person2.followPerson(person1);

      var dist = person1.phys.position.subtract(person2.phys.position);
			if (vars.offset2 != -1) {
				vars.offset2 = person2.moveAlongPath(vars.offset2,event.delta);
			}
			if(dist.length < 2.25 * RAD){
				person2.clearPath();
				vars.count++;
				person3.eagerness = 15;
				person3.arousal = 0;
				person3.focus = 15;		//fir aa gaya?

				person1.eagerness = 8;
				person1.arousal = 8;
				person1.focus = 20;		//resurgent
				if(vars.count > 65){
          vars.count = 0;
          vars.framecount = 0;
          vars.offset2 = 0;
          nextmove = person1_goto_person3;
        }
			}
		}

		function p3_move__p1_follow_p2(event) {
			console.log("person3_move__person1_follow_person2");

			if(vars.framecount==0){
//main movement call
				person3.moveToPoint(new Point(WIDTH - 7.5 * RAD,0.1 * HEIGHT));
			}

      if (vars.offset3 != -1) {
				vars.offset3 = person3.moveAlongPath(vars.offset3,event.delta);
			}

//simultaneous movement
			person1.followPerson(person2);


			var dist = person1.phys.position.subtract(person2.phys.position);
			vars.framecount++;
			if (vars.offset1 != -1) {
				vars.offset1 = person1.moveAlongPath(vars.offset1,event.delta);
			}

			if(dist.length <= 4.1 * RAD){
				vars.offset1 = -1;
			}
			if(vars.offset3 == -1 && vars.offset1 == -1) {
					person2.clearPath();
					person2.eagerness = 5;
					person2.arousal = 0;
					person2.focus = 15;		//gonna advise

					person1.eagerness = 4;
					person1.arousal = 1;
					person1.focus = 5;		//sad

          vars.offset3 = 0;
          vars.offset1 = 0;
          vars.framecount = 0;
				  nextmove = person2_goto_person1;
			}
		}

function person1_avoid_person3(event) {

	console.log("In person1_avoid_person3");
	//switching to next movement and updating emotions
	if(vars.count == 3){
		person3.clearPath();
		person1.clearPath();

		person3.eagerness = 4;
		person3.arousal = 0;
		person3.focus = 10;		//satisfied

		person1.eagerness = 3;
		person1.arousal = 1;
		person1.focus = 13;		//sad

		vars.count = 0;
		vars.offset1 = 0;
		vars.offset2 = 0;
		nextmove = p3_move__p1_follow_p2;
	}
//main movement call
	person1.retreatFromPerson(person3,5 * RAD);


	if (vars.offset1 != -1) {
		vars.offset1 = person1.moveAlongPath(vars.offset1,event.delta);
	}
		var dist = person3.phys.position.subtract(person1.phys.position);
		if (dist.length > 5 * RAD) {
			person3.clearPath();
			person1.clearPath();
			vars.count++;
			vars.approachmode = true;
			vars.offset1 = 0;
			vars.offset3 = 0;
			nextmove = person3_approach_person1;
		}
}

		function person3_approach_person1(event) {
		console.log("In person3_approach_person1");

			if (vars.approachmode) {

//main movement call
			 person3.followPerson(person1);


				if (vars.offset3 != -1) {
					vars.offset3 = person3.moveAlongPath(vars.offset3,event.delta);
				}
				var dist = person3.phys.position.subtract(person1.phys.position);
				if (dist.length < 2.3 * RAD) {
					person3.clearPath();
					person1.clearPath();
					vars.approachmode = false;
					vars.offset1 = 0;
					vars.offset2 = 0;
				}
			 } else {
				 nextmove = person1_avoid_person3;
				}

		}

		function person1_move(event) {
			console.log("In scene 1");
			if (vars.framecount === 0) {
				person1.clearPath();
				person3.clearPath();
			}
			vars.framecount++;

//main movement call
			var endpt = new Point(person3.phys.position.x, person1.phys.position.y);
			person1.moveToPoint(endpt);

//switching to next movement and updating emotions
			if (vars.offset1 != -1) {
				vars.offset1 = person1.moveAlongPath(vars.offset1,event.delta);
			} else {
				console.log("Switching to Scene 2");
			 person1.arousal = 4;
			 person1.eagerness = 7;
			 person1.focus = 15;	//scared

			 person3.arousal = 5;
			 person3.eagerness = 20;
			 person3.focus = 20;	//gonna hit

			 vars.framecount = 0;
			 vars.offset1 = 0;
			 nextmove = person3_approach_person1;
			}
		}

		var nextmove = person1_move;
		view.onFrame = function(event) {
			nextmove(event);
		}
	}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>
