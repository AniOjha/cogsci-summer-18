<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Consulting</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emotion_threeparam.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');
		console.log("WHAT");
		var RAD = 15;
		var WIDTH = view.size.width;
		var HEIGHT = view.size.height;

		var guru = new Person(false,new Point(0.1 * WIDTH,0.4 * HEIGHT),2,-8,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'red'
		}));

		var bully = new Person(false,new Point(WIDTH - 7.5 * RAD,0.1 * HEIGHT),7,6,20,new Path.Circle({
			center : view.center,
			radius : 1.3 * RAD,
			fillColor : 'black'
		}));

    var hero = new Person(false,new Point(WIDTH - 1.0 * RAD,0.25 * HEIGHT),0.1,2,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'blue'
		}));

		var scene1vars = {
			offset1 : 0,
      offset2 : 0,
			framecount : 0
		}

		var scene2vars = {
			offset1 : 0,
			offset2 : 0,
			approachmode : true,
			count : 0,
			framecount : 0
		}

		var scene3vars = {
			offset1 : 0,
			offset2 : 0,
			framecount : 0
		}

		var scene4vars = {
			offset1 : 0,
			offset2 : 0,
			framecount : 0,
			framecount1 : 0
		}

		var scene5vars = {
			offset1 : 0,
			offset2 : 0,
			framecount : 0
		}

		var scene6vars = {
			offset1 : 0,
			offset2 : 0,
			offset3 : 0,
			count : 0,
			framecount : 0
		}

		var scene7vars = {
			offset1 : 0,
			offset2 : 0,
			framecount : 0
		}

		function scene7(event) {
			console.log("Scene 7");
			if(scene7vars.framecount==0){
				hero.clearPath();
				guru.clearPath();
			}
			scene7vars.framecount++;
			hero.followPerson(guru);
			guru.retreatFromPerson(hero, 5 * RAD);
			if (scene7vars.offset2 != -1) {
				scene7vars.offset2 = hero.moveAlongPath(scene7vars.offset2,event.delta);
			}
			if (scene7vars.offset1 != -1) {
				scene7vars.offset1 = guru.moveAlongPath(scene7vars.offset1,event.delta);
			}
			if ((scene7vars.offset2 == -1 && scene7vars.offset1 == -1) || guru.phys.position.x < -1000) {
				console.log("End");
			}
		}


		function scene6(event) {
			console.log("Scene 6");
			var dist = hero.phys.position.subtract(guru.phys.position);
			if(scene6vars.framecount==0){
				hero.clearPath();
				guru.clearPath();
				hero.moveToPoint(new Point(view.center.x,guru.phys.position.y));
			}
			scene6vars.framecount++;
			if (scene6vars.offset2 != -1) {
				scene6vars.offset2 = hero.moveAlongPath(scene6vars.offset2,event.delta);
			} else if(dist.length > 3 * RAD){
				if(scene6vars.count++ == 0) hero.clearPath();
				hero.followPerson(guru);
				if (scene6vars.offset1 != -1 && dist.length > 3 * RAD) {
					console.log("Hit Guru");
					scene6vars.offset1 = hero.moveAlongPath(scene6vars.offset1,event.delta);
				}
			} else {
				guru.eagerness = 8;
				guru.arousal = 0;
				guru.focus = 10;		//bhaago

				hero.eagerness = 6;
				hero.arousal = 7;
				hero.focus = 7;		//a n g e r y
				currentScene = scene7;
			}
		}

		function scene5(event) {
			console.log("Scene 5");
			if(scene5vars.framecount==0){
				hero.clearPath();
				bully.clearPath();
			}
			scene5vars.framecount++;
			hero.followPerson(bully);
			var dist = hero.phys.position.subtract(bully.phys.position);
			if (scene5vars.offset1 != -1 && dist.length > 5 * RAD) {
				scene5vars.offset1 = hero.moveAlongPath(scene5vars.offset1,event.delta);
			} else if(dist.length > 2.45 * RAD){
				bully.followPerson(hero);
				if (scene5vars.offset2 != -1) {
					scene5vars.offset2 = bully.moveAlongPath(scene5vars.offset2,event.delta);
				}
			} else {
				guru.eagerness = 4;
				guru.arousal = 0;
				guru.focus = 10;		//bhaago

				hero.eagerness = 4;
				hero.arousal = 1;
				hero.focus = 7;		//a n g e r y
				currentScene = scene6;
			}

		}

		 function scene4(event) {
		 	console.log("In scene 4");
			if(scene4vars.framecount==0){
				guru.clearPath();
			}
			scene4vars.framecount++;
			guru.followPerson(hero);
			var dist = hero.phys.position.subtract(guru.phys.position);
			if (scene4vars.offset2 != -1) {
				scene4vars.offset2 = guru.moveAlongPath(scene4vars.offset2,event.delta);
			}
			if(dist.length < 2.25 * RAD){
				guru.clearPath();
				scene4vars.framecount1++;
				bully.eagerness = 15;
				bully.arousal = 0;
				bully.focus = 15;		//fir aa gaya?

				hero.eagerness = 8;
				hero.arousal = 8;
				hero.focus = 20;		//resurgent
				if(scene4vars.framecount1>65)
				currentScene = scene5;
			}
		}

		function scene3(event) {
			console.log("Scene 3");
			console.log(scene3vars.offset1);
			console.log(scene3vars.offset2);
			if(scene3vars.framecount==0){
				// bully.clearPath();
				// hero.clearPath();
				bully.moveToPoint(new Point(WIDTH - 7.5 * RAD,0.1 * HEIGHT));
				//hero.followPerson(guru);
			}
			hero.followPerson(guru);
			var dist = hero.phys.position.subtract(guru.phys.position);
			scene3vars.framecount++;
			if (scene3vars.offset1 != -1) {
				scene3vars.offset1 = hero.moveAlongPath(scene3vars.offset1,event.delta);
			}
			if (scene3vars.offset2 != -1) {
				scene3vars.offset2 = bully.moveAlongPath(scene3vars.offset2,event.delta);
			}
			if(dist.length <= 4.1 * RAD){
				scene3vars.offset1 = -1;
			}
			if(scene3vars.offset2 == -1 && scene3vars.offset1 == -1) {
					guru.clearPath();
					guru.eagerness = 5;
					guru.arousal = 0;
					guru.focus = 15;		//gonna advise

					hero.eagerness = 4;
					hero.arousal = 1;
					hero.focus = 5;		//sad
				  currentScene = scene4;
			}
		}

		function scene2(event) {
		console.log("In scene 2");
		if (scene2vars.count < 3) {
			if (scene2vars.approachmode) {
			 bully.followPerson(hero);
				if (scene2vars.offset1 != -1) {
					scene1vars.offset1 = bully.moveAlongPath(scene1vars.offset1,event.delta);
				}
				var dist = bully.phys.position.subtract(hero.phys.position);
				if (dist.length < 2.3 * RAD) {
					bully.clearPath();
					hero.clearPath();
					scene2vars.approachmode = false;
					scene2vars.offset1 = 0;
					scene2vars.offset2 = 0;
				}
			 } else {
				hero.retreatFromPerson(bully,5 * RAD);
				if (scene2vars.offset2 != -1) {
					scene2vars.offset2 = hero.moveAlongPath(scene2vars.offset2,event.delta);
				}
					var dist = bully.phys.position.subtract(hero.phys.position);
					if (dist.length > 5 * RAD) {
						bully.clearPath();
						hero.clearPath();
						scene2vars.count++;
						scene2vars.approachmode = true;
						scene2vars.offset1 = 0;
						scene2vars.offset2 = 0;
					}
				}
		} else {
			bully.clearPath();
			hero.clearPath();

			bully.eagerness = 4;
			bully.arousal = 0;
			bully.focus = 10;		//satisfied

			hero.eagerness = 3;
			hero.arousal = 1;
			hero.focus = 13;		//sad
			currentScene = scene3;
		}

		}

		function scene1(event) {
			console.log("In scene 1");
			if (scene1vars.framecount === 0) {
				hero.clearPath();
				bully.clearPath();
			}
			scene1vars.framecount++;
			//var dif = (bully.phys.position.subtract(hero.phys.position)).length;
			var endpt = new Point(bully.phys.position.x, hero.phys.position.y);
			hero.moveToPoint(endpt);
			if (scene1vars.offset1 != -1) {
				scene1vars.offset1 = hero.moveAlongPath(scene1vars.offset1,event.delta);
			} else {
				console.log("Switching to Scene 2");
			 hero.arousal = 4;
			 hero.eagerness = 7;
			 hero.focus = 15;	//scared

			 bully.arousal = 5;
			 bully.eagerness = 20;
			 bully.focus = 20;	//gonna hit

			 currentScene = scene2;
			}
		}

		var currentScene = scene1;
		view.onFrame = function(event) {
			currentScene(event);
		}
	}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>
