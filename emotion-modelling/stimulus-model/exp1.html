<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Alcoholic</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="emotion_threeparam.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
		paper.setup('canvas');
		var RAD = 15;
		var WIDTH = view.size.width;
		var HEIGHT = view.size.height;
		var alcoholic = new Person(false,new Point(0.1 * WIDTH,0.4 * HEIGHT),2,-8,20,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'red'
		}));
		var wife = new Person(true,new Point(WIDTH - 2.05 * RAD,0.1 * HEIGHT),0,0,0,new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'pink'
		}));
		var bar = new Path.Rectangle(new Point(0.2 * WIDTH,HEIGHT * 0.6),new Size(200,100));
		bar.fillColor = 'yellow';
		var bartender = new Path.Circle({
			center : view.center,
			radius : RAD,
			fillColor : 'blue'
		});

		var alcohol = new Path.Circle({
			center : view.center,
			radius : 5,
			fillColor : 'green'
		})
		bartender.position = new Point(0.2 * WIDTH + 100,0.5 * HEIGHT + 200 + 2.5 * RAD);
		alcohol.position = bartender.position.add(new Point(30,-100));
		alcohol.visible = false;
		var scene1vars = {
			offset : 0,
			framecount : 0
		}

		var scene2vars = {
			offset : 0,
			offset2 : 0,
			framecount : 0
		}

		var scene3vars = {
			offset : 0,
			framecount : 0,
			move : true
		}

		var scene4vars = {
			offsetw : 0,
			offseta : 0,
			approachmode : true,
			count : 0,
			framecount : 0
		}

		var scene5vars = {
			offsetw : 0,
			offseta : 0,
			framecount : 0
		}
		function scene5(event) {
			console.log("Scene 5");
			if (scene5vars.offsetw != -1) {
				scene5vars.offsetw = wife.moveAlongPath(scene5vars.offsetw,event.delta);
			}

			if (scene5vars.offseta != -1) {
				scene5vars.offseta = alcoholic.moveAlongPath(scene5vars.offseta,event.delta);
			}
		}

		function scene4(event) {
			console.log("In scene 4");
			if (scene4vars.count < 3) {
				if (scene4vars.approachmode) {
					wife.followPerson(alcoholic);
					if (scene4vars.offsetw != -1) {
						scene4vars.offsetw = wife.moveAlongPath(scene4vars.offsetw,event.delta);
					}
					var dist = wife.phys.position.subtract(alcoholic.phys.position);
					if (dist.length < 2.1 * RAD) {
						wife.clearPath();
						alcoholic.clearPath();
						scene4vars.approachmode = false;
						scene4vars.offsetw = 0;
						scene4vars.offseta = 0;
					}
				} else {
					alcoholic.retreatFromPerson(wife,5 * RAD);
					if (scene4vars.offseta != -1) {
						scene4vars.offseta = alcoholic.moveAlongPath(scene4vars.offseta,event.delta);
						var dist = wife.phys.position.subtract(alcoholic.phys.position);
						if (dist.length > 6 * RAD) {
							wife.clearPath();
							alcoholic.clearPath();
							scene4vars.count++;
							scene4vars.approachmode = true;
							scene4vars.offsetw = 0;
							scene4vars.offseta = 0;
						}
					}
				}
			} else {
				wife.eagerness = 3;
				wife.arousal = 3;
				//wife.debug = true;
				alcoholic.moveToPoint(new Point(bartender.position.x,bartender.position.y - 12 * RAD));
				wife.moveToPoint(new Point(WIDTH - 2.05 * RAD,0.1 * HEIGHT));
				scene4vars.framecount++;
				if (scene4vars.framecount > 20) {
					currentScene = scene5;
				}
			}
		}

		function scene3(event) {
			alcoholic.followPerson(wife);
			//scene3vars.framecount++;
			if (scene3vars.offset != -1 && scene3vars.move) {
				scene3vars.offset = alcoholic.moveAlongPath(scene3vars.offset,event.delta);
			}
			//console.log((alcoholic.phys.position.subtract(wife.phys.position)).length);
			if ((alcoholic.phys.position.subtract(wife.phys.position)).length < 6 * RAD) {
				scene3vars.move = false;
				scene3vars.framecount++;
				if (scene3vars.framecount > 120) {
					wife.arousal = 7;
					wife.eagerness = 10;
					wife.focus = 20;
					wife.debug = false;
					//alcoholic.debug = true;
					wife.clearPath();
					alcoholic.clearPath();
					//alcoholic.debug = true;
					currentScene = scene4;
				}
			}
		}

		function scene2(event) {
			//console.log("Offset " + scene2vars.offset + " Pathlength " + alcoholic.movement.path.length);
			if (scene2vars.offset != -1) {
				scene2vars.offset = alcoholic.moveAlongPath(scene2vars.offset,event.delta);
			} else {
				//console.log("I have entered");
				alcohol.visible = true;
				alcoholic.moveToPoint(alcohol.position);
				var diff = alcohol.position.y - alcoholic.phys.position.y;
				//console.log(diff);
				if (diff > 0) {
					alcohol.position.y -= 60 * event.delta;
				} else {
					if (scene2vars.offset2 != -1) {
						scene2vars.offset2 = alcoholic.moveAlongPath(scene2vars.offset2,event.delta);
					} else {
						alcohol.visible = false;
						alcoholic.eagerness = 4;
						alcoholic.arousal = 3;
						alcoholic.focus = 5;
						//alcoholic.debug = true;
						alcoholic.clearPath();
						currentScene = scene3;
					}
				}
			}
		}

		function scene1(event) {
			if (scene1vars.framecount === 0) {
				alcoholic.clearPath();
			}
			scene1vars.framecount++;
			alcoholic.followPerson(wife);
			if (scene1vars.offset != -1) {
				scene1vars.offset = alcoholic.moveAlongPath(scene1vars.offset,event.delta);
			}
			var dif = (alcoholic.phys.position.subtract(bartender.position)).x;
			console.log("Diff " + (alcoholic.phys.position.subtract(bartender.position)).x);
			if (dif >= 0) {
				console.log("Switching to Scene 2");
				alcoholic.arousal = 2;
				alcoholic.eagerness = 5;
				alcoholic.focus = 16;
				//alcoholic.debug = true;
				alcoholic.moveToPoint(new Point(bartender.position.x,bartender.position.y - 12 * RAD));
				currentScene = scene2;
			}
		}
		var currentScene = scene1;
		view.onFrame = function(event) {
			currentScene(event);
		}
	}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>