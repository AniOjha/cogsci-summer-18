<html>
<head>
	<meta charset="utf-8">
	<title>Emotion Test</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="finalsteer.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
			paper.setup('canvas');

			var persongrid = new PersonGrid(view.size.width,view.size.height);
			var personarray = new Array(4);

			var loc = new Locomotion({
				velocity : new Point(-0.001,-0.001),
				mass : 1,
				speed : 0,
				boundingRadius : 25,
				maxForce : 4000000,
				maxSpeed : 5,
				shape : new Path.Circle({
					center : view.center,
					radius : 15,
					fillColor : 'red'
				}),
				point : view.center.add(new Point(400,0))
			});
			

			var obstacle1 = new Locomotion({
				velocity : new Point(0.001,0.001),
				mass : 1,
				speed : 0,
				boundingRadius : 25,
				maxForce : 4000000,
				maxSpeed : 5,
				shape : new Path.Circle({
					center : view.center,
					radius : 20,
					fillColor : 'blue'
				}),
				point : view.center.add(new Point(0, -400))
			});

			var target1 = new Locomotion({
				velocity : new Point(0.001,0.001),
				mass : 1,
				speed : 0,
				boundingRadius : 25,
				maxForce : 4000000,
				maxSpeed : 5,
				shape : new Path.Circle({
					center : view.center,
					radius : 20,
					fillColor : 'blue'
				}),
				point : view.center.add(new Point(0, 0))
			});

			var target2 = new Locomotion({
				velocity : new Point(0.001,0.001),
				mass : 1,
				speed : 0,
				boundingRadius : 25,
				maxForce : 4000000,
				maxSpeed : 5,
				shape : new Path.Circle({
					center : view.center,
					radius : 20,
					fillColor : 'blue'
				}),
				point : view.center.add(new Point(0, 0))
			});


			persongrid.set(loc.shape.position,loc);
	  		persongrid.set(obstacle1.shape.position,obstacle1);
			persongrid.set(target1.shape.position,target1);
			persongrid.set(target2.shape.position,target2);

			


			view.onFrame = function(event) {

				personarray[0] = persongrid.localSearch(loc.position.x-4*15, loc.position.x+10*15, loc.position.y-10*15, loc.position.y+10*15, loc);
				personarray[1] = persongrid.localSearch(obstacle1.position.x-4*15, obstacle1.position.x+10*15, obstacle1.position.y-10*15, obstacle1.position.y+10*15, obstacle1);
				personarray[2] = persongrid.localSearch(target1.position.x-4*15, target1.position.x+10*15, target1.position.y-10*15, target1.position.y+10*15, target1);
				personarray[3] = persongrid.localSearch(target2.position.x-4*15, target2.position.x+10*15, target2.position.y-10*15, target2.position.y+10*15, target2);

				var locprev = loc.shape.position;
      			var obstacle1prev = obstacle1.shape.position;
      			var target1prev = target1.shape.position;
      			var target2prev = target2.shape.position;

      			//console.log(loc.shape.position);

				loc.steer(loc.steeringSeek(target1.shape.position), event.delta, personarray[0]);
				obstacle1.steer(obstacle1.steeringSeek(target2.shape.position), event.delta, personarray[1]);

				persongrid.update(locprev,loc.shape.position,loc);
				persongrid.update(obstacle1prev,obstacle1.shape.position,obstacle1);
				persongrid.update(target1prev,target1.shape.position,target1);
				persongrid.update(target2prev,target2.shape.position,target2);
				
				//var person_array = persongrid.localSearch(0,960,0,960,loc);


				var selrect = new Path.Rectangle(new Point(loc.position.x-4*15, loc.position.y-10*15), new Point(loc.position.x+10*15, loc.position.y+10*15))
				selrect.selected = false;
			}

		}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>