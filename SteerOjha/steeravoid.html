<html>
<head>
	<meta charset="utf-8">
	<title>Emotion Test</title>
	<script type="text/javascript" src="paper.js"></script>
	<script type="text/javascript" src="steeravoid.js"></script>
	<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
			paper.setup('canvas');

			var persongrid = new PersonGrid(view.size.width,view.size.height);
			var personarray;

			var hero = new Locomotion({
				velocity : new Point(0, 1),
				mass : 1,
				speed : 10,
				boundingRadius : 25,
				maxForce : 1000,
				maxSpeed : 500,
				point : new Point(0,-200),
				shape : new Path.Circle({
					center : view.center,
					radius : 15,
					fillColor : 'red'
				})
			});

			var target = new Locomotion({
				velocity : new Point(0, -0.001),
				mass : 1,
				speed : 10,
				boundingRadius : 25,
				maxForce : 1000,
				maxSpeed : 500,
				point : new Point(0,0),
				shape : new Path.Circle({
					center : view.center,
					radius : 15,
					fillColor : 'red'
				})
			});

			var obstacle1 = new Locomotion({
				velocity : new Point(0,100),
				mass : 1,
				speed : 10,
				boundingRadius : 25,
				maxForce : 1000,
				maxSpeed : 500,
				point : new Point(300,40),	
				shape : new Path.Circle({
					center : view.center,
					radius : 15,
					fillColor : 'red'
				})
			});

			var obstacle2 = new Locomotion({
				velocity : new Point(0,100),
				mass : 1,
				speed : 10,
				boundingRadius : 25,
				maxForce : 1000,
				maxSpeed : 500,
				point : new Point(-300,0),			
				shape : new Path.Circle({		
					center : view.center,
					radius : 15,
					fillColor : 'red'
				})
			});

			persongrid.set(hero.position,hero);
	  		persongrid.set(obstacle1.position,obstacle1);
			persongrid.set(obstacle2.position,obstacle2);
			persongrid.set(target.position,target);


			view.onFrame = function(event) {

				personarray = persongrid.localSearch(hero.position.x-4*15, hero.position.x+10*15, hero.position.y-10*15, hero.position.y+10*15, hero);
				var heroprev = hero.position;
      			var obstacle1prev = obstacle1.position;
      			var obstacle2prev = obstacle2.position;
				var targetprev = target.position;

				hero.steer(new Point(0,100), event.delta, personarray);
				target.steer(new Point(0, -200), event.delta, personarray);

				persongrid.update(heroprev,hero.position,hero);
				persongrid.update(obstacle1prev,obstacle1.position,obstacle1);
				persongrid.update(obstacle2prev,obstacle2.position,obstacle2);
				persongrid.update(targetprev,target.position,target);
				//var person_array = persongrid.localSearch(0,960,0,960,hero);


				var selrect = new Path.Rectangle(new Point(hero.position.x-4*15, hero.position.y-10*15), new Point(hero.position.x+10*15, hero.position.y+10*15))
				selrect.selected = false;
			}
		}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="960"></canvas>
</body>
</html>