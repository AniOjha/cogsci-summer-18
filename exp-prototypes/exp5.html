<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Ain't It Awful</title>
	<script type="text/javascript" src="http://dsambrano.com/demos/paper.js"></script>
	<script type="text/paperscript" canvas = "canvas">
		var car = new Path.Rectangle(view.center + [-500,-50],200,100);
		car.fillColor = 'yellow';
		var man = new Path.Circle({
			center : view.center,
			radius : 10,
			fillColor : 'blue'
		});
		var trianglepos = new Point(20,view.size.height * 0.8);
		var triangle1 = new Path.RegularPolygon(trianglepos,3,20);
		var triangle2 = new Path.RegularPolygon(trianglepos + [0,40],3,20);
		var triangle3 = new Path.RegularPolygon(trianglepos + [40,40],3,20);
		var triangle4 = new Path.RegularPolygon(trianglepos + [50,0],3,20);
		triangle1.fillColor = 'green';
		triangle1.rotate(90);
		triangle2.fillColor = 'green';
		triangle2.rotate(90);
		triangle3.fillColor = 'green';
		triangle3.rotate(90);
		triangle4.fillColor = 'green';
		triangle4.rotate(90);
		man.position = view.center + new Point(300,-300);
		var scene1vars = {
			carspeed : new Point(0.5,0),
			manspeed : new Point(-7,0)
		}
		var scene0vars = {
			manspeed : new Point(0,7)
		}
		var scene2vars = {
			clusterpoint : new Point(view.size.width * 0.85,view.size.height * 0.85),
			reachpoint : new Point(view.size.width * 0.75,view.size.height * 0.85),
			framecount : 0
		}
		var scene3vars = {
			framecount : 0,
			target : 0
		}
		function scene4(event) {
			console.log("Scene 4");
			if(man.position.x > scene3vars.target) {
				man.position.x -= 1;
				triangle1.rotate(5);
				triangle2.rotate(5);
				triangle3.rotate(5);
				triangle4.rotate(5);
			} else {
				man.position.x -= 2;
				triangle1.position.x -= 2;
				triangle2.position.x -= 2;
				triangle3.position.x -= 2;
				triangle4.position.x -= 2;
			}
		}
		function scene3(event) {
			scene2vars.framecount++;
			man.position += [5 * Math.cos(scene2vars.framecount),5 * Math.cos(scene2vars.framecount)];
			if (triangle1.position.x - scene2vars.reachpoint.x < -30) {
				triangle1.position.x += 2;
				triangle2.position.x += 2;
				triangle3.position.x += 2;
				triangle4.position.x += 2;

			}
			else {
				triangle1.rotate(Math.cos(scene2vars.framecount/12));
				triangle2.rotate(Math.sin(scene2vars.framecount/12));
				triangle3.rotate(Math.cos(scene2vars.framecount/12));
				triangle4.rotate(Math.cos(scene2vars.framecount/12));
				scene3vars.framecount++;
				if (scene3vars.framecount > 180) {
					scene3vars.target = man.position.x - 60;
					currentScene = scene4;
				}
			}
		}
		function scene2(event) {
			scene2vars.framecount++;
			if((man.position - scene2vars.clusterpoint).length > 14) {
				man.position += (scene2vars.clusterpoint - man.position).normalize() * 4;
			}
			else {

				//console.log("In else");
				currentScene = scene3;
				//man.position += new Point(10 * Math.cos(scene2vars.framecount/12),10 * Math.sin(scene2vars.framecount/12));
			}
		}
		function scene1(event) {
			if((car.position - man.position).length < 110) {
				currentScene = scene2;
			} else {
				car.position += scene1vars.carspeed;
				man.position += scene1vars.manspeed;
			}
		}
		function scene0(event) {
			if (view.center.y - man.position.y > 9) {
				man.position += scene0vars.manspeed;
			} else {
				currentScene = scene1;
			}
		}
		currentScene = scene0;
		function onFrame(event) {
			currentScene(event);
		}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="500"></canvas>
</body>
</html>