<!DOCTYPE html>
<html>
<head>
	<title>Consulting Game</title>
	<script type="text/javascript" src="http://dsambrano.com/demos/paper.js"></script>
	<script type="text/paperscript" canvas = "canvas">
		var width = view.width;
		var height = view.height;
		console.log(view.height);
		var bully = new Path.Circle({
			center : view.center + new Point(350,-200),
			radius : 17,
			fillColor : 'black'
		});
		var hero = new Path.Circle({
			center : view.center + new Point(480,-20),
			radius : 10,
			fillColor : 'blue'
		});

		var guru = new Path.Circle({
			center : view.center + new Point(-470,200),
			radius : 10,
			fillColor : 'yellow'
		});
		var currentscene;
		var scene1vars = {
			minapproach : 25,
			scared : 30,
			count : 0,
			approachVelocity : new Point(1.3,0),
			scareVelocity : new Point(0, 7)
		}
		var scene2vars = {
			pushimpulse : Point.random().normalize() * 3,
			setback : new Point(50, -50),
			goback : new Point(0, 2),
			frameenddelay : 0
		}
		var scene3vars = {
			guruapproach : new Point(5, -7.5),
			framecount1 : 0,
			framecount2 : 0
		}
		var scene4vars = {
			pushimpulse : 0,
			framecount : 0
		}
		var scene5vars = {
			flag : 0,
			approachspeed : 2,
			repelspeed : 10
		}
		var scene6vars = {
			approachspeed : new Point(5, 0)
		}
		function scene6(event) {
			console.log("In scene 6");
			var sep = guru.position - hero.position;
			guru.position -= scene6vars.approachspeed;
			hero.position += sep.normalize()*5;
		}
		function scene5(event) {
			console.log("In scene 5");
			var dist = guru.position - hero.position;
			if(dist.length < 20) {
				console.log(dist.length);
				//guru.position += dist.normalize() * scene5vars.repelspeed;
				hero.position -= dist.normalize() * scene5vars.repelspeed;
			} else {
				hero.position += dist.normalize() * scene5vars.approachspeed;
				scene5vars.flag++;
				console.log(scene5vars.flag);
				if(scene5vars.flag==200){
					currentscene = scene6;
				}
			}
		}
		function scene4(event) {
			console.log("In scene 4");
			var sep = bully.position.x - guru.position.x;
			if(hero.position.x > sep/2){
				console.log(hero.position);
				console.log(sep);
				hero.position += scene4vars.pushimpulse;
			} else {
				currentscene = scene5;
			}
		}
		function scene3(event) {
			console.log("In scene 3");
			scene3vars.framecount1++;
			console.log(scene3vars.framecount1);
			var dist = bully.position - hero.position;
			if(guru.position.y-hero.position.y>10 && scene3vars.framecount1<80) {
				console.log(scene3vars.framecount1);
				guru.position += scene3vars.guruapproach.normalize()*0.8;
			} else if (scene3vars.framecount1>155 && dist.length > 60){
				hero.position += dist.normalize()*6;
			} else if(scene3vars.framecount1>160 && dist.length > 28.4){
				bully.position -= dist.normalize()*10;
			} else if(!(dist.length > 28.4)){
				scene4vars.pushimpulse = dist.normalize()*-1;
				currentscene = scene4;
			}
		}
		function scene2(event) {
			scene2vars.frameenddelay++;
			console.log("In scene 2");
			console.log(scene2vars.frameenddelay);
			var x = hero.position.x + scene2vars.pushimpulse.x;
			var y = hero.position.y + scene2vars.pushimpulse.y;
			var target = guru.position + scene2vars.setback;
			var separation = target - hero.position;
			if(bully.position.y > 20){
				bully.position -= scene2vars.goback;
			}
			console.log(scene2vars.pushimpulse);
			if(y/2 < separation.y){
      	hero.position += scene2vars.pushimpulse.normalize()*2;
			} else if(scene2vars.frameenddelay > 105 && guru.position.y - hero.position.y > 50){
				console.log(hero.position.y - guru.position.y);
				hero.position += separation.normalize()*2;
			} else if (guru.position.y - hero.position.y < 50){
				currentscene = scene3;
			}
		}
		function scene12(event) {
		    console.log("In scene 12");
			var dist = hero.position.x - bully.position.x;
			var sep = hero.position.y - bully.position.y;
			var separation = hero.position - bully.position;
			if(separation<27){
				hero.position += separation.normalize()*3;
			} else if (sep > scene1vars.scared) {
				//bully.position += scene1vars.scareVelocity;
				bully.position += separation.normalize()*10;
				hero.position += separation.normalize();
			}	else {
				scene2vars.pushimpulse = separation.normalize();
				currentscene = scene2;
			}
		}
		function scene11(event) {
		    console.log("In scene 11");
			var dist = hero.position.x - bully.position.x;
			var sep = hero.position.y - bully.position.y;
			var separation = hero.position - bully.position;
			if(separation<27){
				hero.position += separation.normalize()*3;
			} else if (sep > scene1vars.scared) {
				//bully.position += scene1vars.scareVelocity;
				bully.position += separation.normalize()*10;
				hero.position += separation.normalize();
			} else {
				scene2vars.pushimpulse = separation.normalize();
				currentscene = scene12;
			}
		}
    function scene1(event) {
		    console.log("In scene 1");
			var dist = hero.position.x - bully.position.x;
			var sep = hero.position.y - bully.position.y;
			var separation = hero.position - bully.position;
			if(dist > scene1vars.minapproach){
				hero.position -= scene1vars.approachVelocity;
			} else if (sep > scene1vars.scared && scene1vars.count<36000) {
				//bully.position += scene1vars.scareVelocity;
				bully.position += separation.normalize()*10;
				hero.position += separation.normalize();
			} else if(scene3vars.count<36000){
				scene1vars.count++;
				hero.position += separation.normalize()*3;
			}	else {
				scene2vars.pushimpulse = separation.normalize();
				currentscene = scene11;
			}
		}
		currentscene = scene1;
		function onFrame(event) {
			currentscene(event);
		}
	</script>
</head>
<body>
	<canvas id="canvas" width="960" height="500"></canvas>
</body>
</html>
